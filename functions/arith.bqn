# Arithmetic functions

name â‡ "arith"

arith â† +â€¿-â€¿Ã—

xmax â† 2e6
measure â‡ 127 { maxğ•Šfn:
  GetGen â† {
    âŸ¨RandâŸ© â† âŸ¨ğ•©âŸ© â€¢Import "../measure/gen.bqn"
    (âŒˆmaxÃ·2) -Ëœ ğ•© Rand maxË™
  }
  TimeParams â‡ {
    # Use one generator for both arguments
    Ã—Ë™âŠ¸â‰ fn ? l â† 1â€¿2/âŸ¨fn, GetGenğ•©âŸ© ;
    # For Ã— arguments need to interact to suppress overflow: use two
    # parallel generators but run each twice so each argument sees both
    # sets of random numbers
    âŸ¨fnâŸ© âˆ¾ âŠ£â€¿{(Ã—Ã—(âŒŠmaxÃ·|ğ•¨)âŒŠ|)ğ•©} {ğ•â—‹ğ•Ëœ}âŸœGetGenÂ¨ <ğ•©
  }
  timeInit â‡ 1e5â€¿1â€¿1e3
  xmax â‡ xmax
}âŒœ arith

plotOpts â‡ {
  title â‡ "Arithmetic on 1-byte values, no overflow"
  xcapt â‡ "Size"
  ycapt â‡ "Time (ns / value)"
  labels â‡ â€¢ReprÂ¨ arith
  ChangeBounds â‡ xmaxâ€¿10âŠ¸âŒŠ
}
