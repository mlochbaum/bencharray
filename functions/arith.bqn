# Arithmetic functions

name â‡ "arith"

types â† â€¢Import "../params/cputype.bqn"
fns   â† â€¢Import "../params/arith.bqn"
params â‡ typesâ€¿fns

Measure â‡ { ğ•Š typeâ€¿fn:
  floatâ€¿sizeâ€¿max â† type
  scale â‡ âŸ¨(2â‹†3+15)Ã·sizeâŸ©
  Result â‡ {xğ•Šy: âŠ‘1e9Ã—yÃ·x}
  GetGen â† {
    âŸ¨RandâŸ© â† âŸ¨ğ•©âŸ© â€¢Import "../measure/gen.bqn"
    (âŒˆ(1âŒˆmax)Ã·2) -Ëœ ğ•© Rand maxË™
  }
  TimeParams â‡ {
    # Use one generator for both arguments
    float âˆ¨ Ã—Ë™âŠ¸â‰ fn ? l â† 1â€¿2/âŸ¨fn, GetGenğ•©âŸ© ;
    # In integer Ã— arguments need to interact to suppress overflow: use
    # two parallel generators but run each twice so each argument sees
    # both sets of random numbers
    âŸ¨fnâŸ© âˆ¾ âŠ£â€¿{(Ã—Ã—(âŒŠmaxÃ·|ğ•¨)âŒŠ|)ğ•©} {ğ•â—‹ğ•Ëœ}âŸœGetGenÂ¨ <ğ•©
  }
  timeInit â‡ 1e5â€¿1â€¿1e3
}

PlotPre â‡ {> (â†•4)âŠ¸â‹ˆÂ¨ <Ë˜â‰ğ•©}
plotOpts â‡ {
  title â‡ "Arithmetic with no overflow, 32KB"
  x â‡ types
  y â‡ {nameâ‡"Time (ns / value)"}
  labels â‡ {ğ•©.DispÂ¨ ğ•©.range} fns
}
