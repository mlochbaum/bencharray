# Arithmetic functions

basename â† "arith"

ns_v   â† â€¢Import "../params/ns_v.bqn"
types  â† â€¢Import "../params/cputype.bqn"
GetFns â† â‹ˆ â€¢Import "../params/arith.bqn"Ë™
GetInp â† {nameâ‡"Length" â‹„ rangeâ‡ğ•©}

Measure â† { ğ•Š typeâ€¿fn:
  âŸ¨float,size,max,GetGenâ‡GetGenSmallâŸ© â† type â‹„ sizeâ‡
  TimeParams â‡ {
    # Use one generator for both arguments
    float âˆ¨ Ã—Ë™âŠ¸â‰ fn ? l â† 1â€¿2/âŸ¨fn, GetGenğ•©âŸ© ;
    # In integer Ã— arguments need to interact to suppress overflow: use
    # two parallel generators but run each twice so each argument sees
    # both sets of random numbers
    âŸ¨fnâŸ© âˆ¾ âŠ£â€¿{â€¢internal.Squeeze(Ã—Ã—(âŒŠmaxÃ·|ğ•¨)âŒŠ|)ğ•©} {ğ•â—‹ğ•Ëœ}âŸœGetGenÂ¨ <ğ•©
  }
}

Bench â† {
  extâ€¿fnsâ€¿rangeâ€¿plotpreâ€¿plotname â† ğ•©
  name â‡ basenameâˆ¾ext
  params â‡ types â‹ˆ fnobjs â† GetFns fns
  input â‡ GetInp range
  result â‡ ns_v
  Measure â‡ Measure
  PlotPreâ‡
  plotOpts â‡ {
    title â‡ plotname
    x â‡ types
    y â‡ result
    labels â‡ {ğ•©.DispÂ¨ ğ•©.num} fnobjs
  }
}
Summary â† Benchâˆ˜{
  extâ‡ğ•¨ â‹„ fnsâ€¿plotname â‡ ğ•©
  Range â‡ {<(2â‹†3+15)Ã·ğ•©.size}
  PlotPre â‡ {> types.numâŠ¸â‹ˆÂ¨ <Ë˜â‰1âŠ‘â‰1ğ•©}
}

âŸ¨
  "-summary" Summary âŸ¨Ã—â€¿+â€¿âŒŠâ€¿<,      "Arithmetic with no overflow, 32KB"âŸ©
  "-small"   Summary âŸ¨Ã—â€¿+â€¿-â€¿âŒŠâ€¿âŒˆ,    "Arithmetic with no overflow, 32KB"âŸ©
  "-compare" Summary âŸ¨<â€¿>â€¿=â€¿â‰ â€¿â‰¤â€¿â‰¥,  "Comparisons, 32KB"âŸ©
  "-slow"    Summary âŸ¨(â‹†â¼)â€¿â‹†â€¿âˆšâ€¿|â€¿Ã·, "Slow arithmetic, 32KB"âŸ©
âŸ©
