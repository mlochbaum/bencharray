# Arithmetic functions

name â‡ "arith"

types â† â€¢Import "../params/cputype.bqn"
fns   â† â€¢Import "../params/arith.bqn"
params â‡ typesâ€¿fns

input â‡ {
  name â‡ "Length"
  Range â‡ {<(2â‹†3+15)Ã·ğ•©.size}
}

result â‡ {
  name â‡ "Time (ns / value)"
  Calc â‡ {ğ•¨ğ•Šxâ€¿y: xâ‹ˆ1e9Ã—yÃ·x}
}

Measure â‡ { ğ•Š typeâ€¿fn:
  âŸ¨float,size,max,GetGenâ‡GetGenSmallâŸ© â† type â‹„ sizeâ‡
  TimeParams â‡ {
    # Use one generator for both arguments
    float âˆ¨ Ã—Ë™âŠ¸â‰ fn ? l â† 1â€¿2/âŸ¨fn, GetGenğ•©âŸ© ;
    # In integer Ã— arguments need to interact to suppress overflow: use
    # two parallel generators but run each twice so each argument sees
    # both sets of random numbers
    âŸ¨fnâŸ© âˆ¾ âŠ£â€¿{(Ã—Ã—(âŒŠmaxÃ·|ğ•¨)âŒŠ|)ğ•©} {ğ•â—‹ğ•Ëœ}âŸœGetGenÂ¨ <ğ•©
  }
  timeInit â‡ 1e5â€¿1â€¿1e3
}

PlotPre â‡ {> types.numâŠ¸â‹ˆÂ¨ <Ë˜â‰1âŠ‘â‰1ğ•©}
plotOpts â‡ {
  title â‡ "Arithmetic with no overflow, 32KB"
  x â‡ types
  y â‡ result
  labels â‡ {ğ•©.DispÂ¨ ğ•©.range} fns
}
