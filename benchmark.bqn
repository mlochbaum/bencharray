#! /usr/bin/env bqn

types â† "measure"â€¿"plot"â€¿"all"â€¿"list"â€¿"help"
type â† âŠ‘ types âŠ 1â†‘â€¢args

Exit â† â€¢Exitâˆ˜âŠ£âŸœâ€¢Out
âŸ¨AtâŸ© â† â€¢file

{type<1-Ëœâ‰ types?@;
  0 Exit "Usage: benchmark.bqn (help|list|measure|plot|all) [functions...]"
}

{typeâ‰ 2-Ëœâ‰ types?@; # List
  c â† -â‰  ext â† ".bqn"
  0 Exit "Available functions:"âˆ¾âˆ¾(@+10)âˆ¾Â¨ câ†“Â¨ (extâ‰¡câŠ¸â†‘)Â¨âŠ¸/ â€¢file.List "functions"
}

{1<â‰ â€¢args?@; 1 Exit "No functions specified" }

fpath â† ("functions"Atâˆ¾âŸœ".bqn")Â¨ fnames â† 1â†“â€¢args

fexist â† 1âˆ˜â€¢file.TypeâŠ0Â¨ fpath
{0=â‰ ğ•©?@; 1 Exit âˆ¾"Unknown functions: "âŒ¾âŠ‘â¥Š(<", ")â‰Ë˜ğ•© } fexistÂ¬âŠ¸/fnames

fns â† âˆ¾ â¥Šâˆ˜â€¢ImportÂ¨ fpath

âŸ¨TimeFnâŸ© â† â€¢Import "measure/time.bqn"
âŸ¨LinePlotâ‡PlotâŸ© â† â€¢Import "plot/line.bqn"

Measure â† {
  paramsâ€¿inputâ€¿resultâ€¿Measure â† ğ•©
  M â† {
    Time â† TimeFn ğ•©.TimeParams
    {âŸ¨iâ‡timeInitâŸ©:TimeÂ¨i;@} ğ•©
    ğ•© result.Calc â‹ˆâŸœ(TimeÂ¨) input.Range ğ•©
  }
  > Mâˆ˜MeasureÂ¨ (<âŸ¨âŸ©) <âŠ¸âˆ¾âŒœÂ´ {ğ•©.range}Â¨ params
}
Plot â† {
  p â† ğ•¨.plotOpts LinePlot ğ•¨.PlotPre ğ•©
  ("output/plot"Atğ•¨.nameâˆ¾".svg") â€¢file.Chars p
}

TName â† { "output/timings" At ğ•©.name }
Write â† TName âŠ¸ â€¢file.Chars âŸœ â€¢Repr
Read  â† â€¢BQN â€¢file.Charsâˆ˜TName

(typeâŠ‘âŸ¨ WriteâŸœMeasure, PlotâŸœRead, (PlotâŠ£Write)âŸœMeasure âŸ©)Â¨ fns
