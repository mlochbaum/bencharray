#! /usr/bin/env bqn

types â† "measure"â€¿"plot"â€¿"all"â€¿"list"â€¿"help"
type â† âŠ‘ types âŠ 1â†‘â€¢args

Exit â† â€¢Exitâˆ˜âŠ£âŸœâ€¢Out
âŸ¨AtâŸ© â† â€¢file

{type<1-Ëœâ‰ types?@;
  0 Exit "Usage: benchmark.bqn (help|list|measure|plot|all) [functions...]"
}

{typeâ‰ 2-Ëœâ‰ types?@; # List
  c â† -â‰  ext â† ".bqn"
  0 Exit "Available functions:"âˆ¾âˆ¾(@+10)âˆ¾Â¨ câ†“Â¨ (extâ‰¡câŠ¸â†‘)Â¨âŠ¸/ â€¢file.List "functions"
}

{1<â‰ â€¢args?@; 1 Exit "No functions specified" }

fns â† â€¢Importâˆ˜("functions"Atâˆ¾âŸœ".bqn")âŠ@Â¨ fnames â† 1â†“â€¢args

{0=â‰ ğ•©?@; 1 Exit âˆ¾"Unknown functions: "âŒ¾âŠ‘â¥Š(<", ")â‰Ë˜ğ•© } (fnsâ‰¡Â¨@)/fnames

âŸ¨TimeFnâŸ© â† â€¢Import "measure/time.bqn"
scale    â† â€¢Import "measure/scale.bqn"
âŸ¨LinePlotâ‡PlotâŸ© â† â€¢Import "plot/line.bqn"

Measure â† {
  M â† {
    Time â† TimeFn ğ•©.TimeParams
    TimeÂ¨ ğ•©.timeInit
    ğ•©.ResultâŸœ(TimeÂ¨) ğ•©.scale
  }
  > Mâˆ˜ğ•©.MeasureÂ¨ (<âŸ¨âŸ©) <âŠ¸âˆ¾âŒœÂ´ {ğ•©.range}Â¨ ğ•©.params
}
Plot â† {
  p â† ğ•¨.plotOpts LinePlot ğ•¨.PlotPre ğ•©
  ("output/plot"Atğ•¨.nameâˆ¾".svg") â€¢file.Chars p
}

TName â† { "output/timings" At ğ•©.name }
Write â† TName âŠ¸ â€¢file.Chars âŸœ â€¢Repr
Read  â† â€¢BQN â€¢file.Charsâˆ˜TName

(typeâŠ‘âŸ¨ WriteâŸœMeasure, PlotâŸœRead, (PlotâŠ£Write)âŸœMeasure âŸ©)Â¨ fns
